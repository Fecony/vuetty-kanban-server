language: node_js
node_js:
  - node

cache:
  directories:
    - 'node_modules'

services:
  - mongodb

before_install:
  - npm i -g npm@latest

install:
  # Install npm dependencies
  - npm ci
  - sleep 15
  # Run server
  - npm run build
  - npm run start:test

jobs:
  include:
    - stage: test
      name: 'Unit Tests'
      script: npm run test
      after_success: npm run test
    - stage: test_two
      name: 'e2e Tests'
      script: npm run test:e2e
      after_success: npm run test:e2e
